# 15.结果集

ResultSet接口定义查询和操作结果的方法。

## 15.1 ResultSet对象的类别

ResultSet可以有不同的功能和特性，比如结果集类型，并发，cursor的保留性。

### 15.1.1 ResultSet类型

在2个地方ResultSet类型会影响他的功能：
1. 游标可以被操作的方式
2. ResultSet反映底层数据源的并发修改数量

3种不同的ResultSet类型如下：

1. TYPE_FORWARD_ONLY
    * 结果集不能滚动，只能向前移动，从开始到最后
    * 结果集包含的行取决于数据库如何实现结果，到底是执行时就包含数据了，还是检索结果时才包含
2. TYPE_SCROLL_INSENSITIVE
    * 结果集是可滚动的，可以向前或向后，相对和绝对位置都可以
    * 当resultSet打开时，底层数据源改变不影响当前已有结果集，在执行和检索结果时都包含行数据
3. TYPE_SCROLL_SENSITIVE
    * 结果集是可滚动的，可以向前或向后，相对和绝对位置都可以
    * 当resultSet打开时，底层数据源改变会影响当前结果集
    
默认类型是TYPE_FORWARD_ONLY.

可以通过 `DatabaseMetaData.supportsResultSetType`查询是否支持某种类型。

如果提供了一个不支持的类型给createStatement, prepareStatement, prepareCall, 需要在Connection对象创建这个statement时
产生一个 SQLWarning。可以通过调用 `ResultSet.getType`获取支持的类型。

### 15.1.2 ResultSet同步性

同步行决定了更新功能的级别，有2个级别：

* CONCUR_READ_ONLY
    * 使用ResultSet接口不能更新ResultSet对象
* CONCUR_UPDATABLE
    * 使用ResultSet接口可以更新ResultSet对象

默认的级别是 CONCUR_READ_ONLY

`DatabaseMetaData.supportsResultSetConcurrency`可以查询指定的级别是否支持。

如果提供了一个不支持的级别给createStatement, prepareStatement, prepareCall, 需要在Connection对象创建这个statement时
产生一个 SQLWarning。可以通过调用 `ResultSet.getConcurrency`获取支持的级别。

在决定同步性级别之前先决定ResultSet的类型。

### 15.1.3 ResultSet保留性

调用Connection.commit可以关闭ResultSet对象，但是，有时不希望这样，保留性就是来控制游标是否在commit时关闭的。

下面的属性可以提供给 Connection的方法： `createStatement, prepareStatement, prepareCall`

1. HOLD_CURSORS_OVER_COMMIT
    * 当commit时不关闭游标
2. CLOSE_CURSORS_AT_COMMIT
    * 当commit调用时关闭游标。在某些应用可能会有更好的性能    

#### 15.1.3.1 确定ResultSet的保留性

这个功能由实现决定， `DatabaseMetaData.getResultSetHoldability`方法可以确定默认的级别。

如果提供了一个不支持的类型给createStatement, prepareStatement, prepareCall, 需要在Connection对象创建这个statement时
产生一个 SQLWarning。

可以通过 `ResultSet.getHoldability`获取这个特性。

### 15.1.4 指定ResultSet类型、同步性和保留性

由 ` Connection.createStatement,Connection.prepareStatement, and Connection.prepareCall `参数指定。

```java
Connection conn = ds.getConnection(user, passwd);
Statement stmt = conn.createStatement(
    ResultSet.TYPE_SCROLL_INSENSITIVE,
    ResultSet.CONCUR_READ_ONLY,
    ResultSet.CLOSE_CURSORS_AT_COMMIT);
```
     
同时对每个功能设置了 setter和getter方法。

## 15.2 创建和操作ResultSet对象

### 15.2.1 创建ResultSet对象





